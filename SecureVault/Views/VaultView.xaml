<UserControl x:Class="SecureVault.Views.VaultView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:SecureVault.Helpers"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800"
             Background="{StaticResource BackgroundBrush}">
    <UserControl.Resources>
        <local:BoolToIconConverter x:Key="BoolToIconConverter"/>

        <!-- Style for ListViewItem with double-click event -->
        <Style x:Key="ListViewItemStyle" TargetType="ListViewItem">
            <EventSetter Event="MouseDoubleClick" Handler="ListViewItem_MouseDoubleClick"/>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Toolbar -->
        <!-- Professional Toolbar with Better Styling -->
        <Border Grid.Row="0" 
        Background="#FAFAFA" 
        BorderBrush="#E0E0E0"
        BorderThickness="0,0,0,1"
        Padding="12,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Left Navigation Buttons -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="0,0,8,0">
                    <Button ToolTip="Navigate Up (Go to parent folder)" 
                    Style="{StaticResource ToolBarButton}" 
                    Command="{Binding NavigateUpCommand}"
                    Width="40" Height="32" Padding="0">
                        <TextBlock Text="↑" FontSize="18" FontWeight="Bold"/>
                    </Button>
                    <Button ToolTip="Refresh vault contents" 
                    Style="{StaticResource ToolBarButton}" 
                    Command="{Binding RefreshCommand}"
                    Width="40" Height="32" Padding="0" Margin="4,0,0,0">
                        <TextBlock Text="⟳" FontSize="18" FontWeight="Bold"/>
                    </Button>
                </StackPanel>

                <!-- Main Action Buttons -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
                    <Button Content="Add Files" 
                    ToolTip="Add files to vault" 
                    Style="{StaticResource ToolBarButton}" 
                    Command="{Binding AddFileCommand}"
                    MinWidth="100" Height="32" Margin="4,0"/>

                    <Button Content="New Folder" 
                    ToolTip="Create a new folder" 
                    Style="{StaticResource ToolBarButton}" 
                    Command="{Binding CreateFolderCommand}"
                    MinWidth="100" Height="32" Margin="4,0"/>

                    <Button Content="Change Password" 
                    ToolTip="Change vault password" 
                    Style="{StaticResource ToolBarButton}" 
                    Command="{Binding ShowChangePasswordCommand}"
                    MinWidth="130" Height="32" Margin="4,0"/>
                </StackPanel>

                <!-- Lock Vault Button (Right Aligned, Red) -->
                <Button Grid.Column="2"
                Content="🔒 Lock Vault"
                ToolTip="Lock vault and return to login"
                Style="{StaticResource ToolBarButton}"
                Background="#FFE5E5" 
                BorderBrush="#FFB3B3"
                Foreground="#D32F2F"
                MinWidth="110" Height="32"
                Command="{Binding LockVaultCommand}"
                Margin="8,0,0,0">
                    <Button.Resources>
                        <Style TargetType="Border">
                            <Setter Property="CornerRadius" Value="6"/>
                        </Style>
                    </Button.Resources>
                </Button>
            </Grid>
        </Border>

        <!-- File List with ItemContainerStyle for double-click -->
        <ListView Grid.Row="2" 
                  ItemsSource="{Binding Files}" 
                  SelectedItem="{Binding SelectedFile}" 
                  Background="White" 
                  BorderThickness="0"
                  ItemContainerStyle="{StaticResource ListViewItemStyle}"
                  ScrollViewer.HorizontalScrollBarVisibility="Auto">

            <ListView.View>
                <GridView>
                    <GridViewColumn Header="Name" Width="350">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding IsFolder, Converter={StaticResource BoolToIconConverter}}" FontSize="16" Margin="0,0,8,0"/>
                                    <TextBlock Text="{Binding FileName}" VerticalAlignment="Center"/>
                                </StackPanel>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                    <GridViewColumn Header="Size" Width="120" DisplayMemberBinding="{Binding FileSizeFormatted}"/>
                    <GridViewColumn Header="Type" Width="100" DisplayMemberBinding="{Binding FileType}"/>
                    <GridViewColumn Header="Modified" Width="180" DisplayMemberBinding="{Binding ModifiedDateFormatted}"/>
                </GridView>
            </ListView.View>

            <ListView.ContextMenu>
                <ContextMenu DataContext="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource Self}}">
                    <MenuItem Header="Open" Command="{Binding OpenCommand}"/>
                    <MenuItem Header="Extract..." Command="{Binding ExtractCommand}"/>
                    <Separator/>
                    <MenuItem Header="Copy" Command="{Binding ContextCopyCommand}" CommandParameter="{Binding SelectedFile}"/>
                    <MenuItem Header="Cut" Command="{Binding ContextCutCommand}" CommandParameter="{Binding SelectedFile}"/>
                    <MenuItem Header="Paste" Command="{Binding PasteCommand}"/>
                    <Separator/>
                    <MenuItem Header="Delete" Command="{Binding ContextDeleteCommand}" CommandParameter="{Binding SelectedFile}"/>
                    <MenuItem Header="Properties" Command="{Binding ContextPropertiesCommand}" CommandParameter="{Binding SelectedFile}"/>
                </ContextMenu>
            </ListView.ContextMenu>
        </ListView>

        <ContentControl Grid.Row="0" Grid.RowSpan="3" 
                        Content="{Binding ModalContent}" 
                        VerticalAlignment="Center" 
                        HorizontalAlignment="Center"/>

        <Border Grid.Row="3" 
                Background="{StaticResource SecondaryBrush}" 
                BorderBrush="{StaticResource BorderBrush}" 
                BorderThickness="0,1,0,0" 
                Padding="15,8">
            <TextBlock Text="{Binding StatusMessage}" FontSize="12" Foreground="{StaticResource TextBrush}"/>
        </Border>
    </Grid>
</UserControl>
